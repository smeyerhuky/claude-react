import{c as T,r as t,j as e,M as L,R as p,f as $,g as O,B as I,P as B,S as z,h as R,i as _,k as F,l as g,m as b}from"./index-CJbHX0Ru.js";import"./scroll-area-B3kHMAdY.js";import{T as V}from"./trash-2-BnKNUDQq.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],H=T("square-pen",A),D=t.memo(({track:s,isLast:o,onPlay:w,onEdit:y,onRemove:C,onTransitionChange:E,onWaveformReady:c,onSpectrogramReady:h,isPlaying:v=!1,currentTime:f=0})=>{const m=t.useRef(null),d=t.useRef(null),[u,j]=t.useState(0),[n,l]=t.useState(!1),r=a=>{const i=Math.floor(a/60),x=Math.floor(a%60);return`${i}:${x.toString().padStart(2,"0")}`};p.useEffect(()=>{m.current&&(c==null||c(s.chainId,m.current))},[s.chainId,c]),p.useEffect(()=>{d.current&&(h==null||h(s.chainId,d.current))},[s.chainId,h]),p.useEffect(()=>{if(v&&!n){const a=s.duration>0?f/s.duration*100:0;j(Math.min(100,Math.max(0,a)))}},[f,s.duration,v,n]);const N=t.useCallback(a=>{var x;if(!n)return;const i=(x=m.current)==null?void 0:x.getBoundingClientRect();if(i){const P=a.clientX-i.left,M=Math.min(100,Math.max(0,P/i.width*100));j(M),M/100*s.duration}},[n,s.duration]),S=t.useCallback(a=>{a.preventDefault(),l(!0),N(a)},[N]);return p.useEffect(()=>{const a=x=>N(x),i=()=>l(!1);if(n)return document.addEventListener("mousemove",a),document.addEventListener("mouseup",i),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i)}},[n,N]),e.jsxs("div",{className:"relative group",children:[e.jsx($,{className:"bg-gradient-to-br from-gray-800 to-gray-900 border-gray-700 hover:border-purple-500 transition-all hover:-translate-y-1 hover:shadow-xl hover:shadow-purple-500/20",children:e.jsxs(O,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-green-400",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>w(s.id),className:"hover:bg-green-600 hover:text-white",children:[e.jsx(B,{className:"w-4 h-4 mr-1"})," Play"]}),e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>y(s.chainId),className:"hover:bg-blue-600 hover:text-white",children:[e.jsx(H,{className:"w-4 h-4 mr-1"})," Edit"]}),e.jsx(I,{size:"sm",variant:"outline",onClick:()=>C(s.chainId),className:"hover:bg-red-600 hover:text-white",children:e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"relative h-20 bg-black/50 rounded-lg mb-4 overflow-hidden border border-gray-700",children:[e.jsx("canvas",{ref:m,className:"w-full h-full",id:`waveform_${s.chainId}`}),e.jsxs("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 shadow-lg cursor-ew-resize transition-all hover:w-1 hover:bg-red-400",style:{left:`${u}%`},onMouseDown:S,title:`${r(u/100*s.duration)} / ${r(s.duration)}`,children:[e.jsx("div",{className:"absolute -top-1 -left-1 w-2 h-2 bg-red-500 rounded-full border border-white shadow-md"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-2 h-2 bg-red-500 rounded-full border border-white shadow-md"})]}),v&&e.jsx("div",{className:"absolute top-0 bottom-0 bg-green-500/20 pointer-events-none transition-all",style:{width:`${u}%`}})]}),e.jsxs("div",{className:"relative h-24 bg-black/50 rounded-lg mb-4 overflow-hidden border border-gray-700",children:[e.jsx("canvas",{ref:d,className:"w-full h-full",id:`spectrogram_${s.chainId}`}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 shadow-lg pointer-events-none",style:{left:`${u}%`}})]}),e.jsx("div",{className:"bg-black/30 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Transition:"}),e.jsxs(z,{value:s.transitionType,onValueChange:a=>E(s.chainId,a),children:[e.jsx(R,{className:"mt-1",children:e.jsx(_,{})}),e.jsxs(F,{children:[e.jsx(g,{value:b.CROSSFADE,children:"Crossfade"}),e.jsx(g,{value:b.CUT,children:"Hard Cut"}),e.jsx(g,{value:b.ECHO,children:"Echo Fade"}),e.jsx(g,{value:b.FILTER,children:"Filter Sweep"}),e.jsx(g,{value:b.REVERSE,children:"Reverse"})]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Duration:"}),e.jsx("div",{className:"font-semibold",children:r(s.duration)})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"BPM:"}),e.jsx("div",{className:"font-semibold",children:s.tempo})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Key:"}),e.jsx("div",{className:"font-semibold",children:s.key})]})]})})]})}),!o&&e.jsx("div",{className:"absolute -bottom-5 right-1/2 translate-x-1/2 z-10",children:e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-bold shadow-lg hover:scale-110 transition-transform cursor-pointer",children:"ðŸ”„"})})]})});D.displayName="ChainTrack";const U=t.memo(({chain:s,onDrop:o,onTrackPlay:w,onTrackEdit:y,onTrackRemove:C,onTransitionChange:E,onWaveformReady:c,onSpectrogramReady:h,isPlaying:v=!1,currentTime:f=0})=>{const[m,d]=t.useState(!1),u=t.useCallback(l=>{l.preventDefault(),d(!0)},[]),j=t.useCallback(()=>{d(!1)},[]),n=t.useCallback(l=>{l.preventDefault(),d(!1);const r=l.dataTransfer.getData("trackId");r&&(o==null||o(r))},[o]);return e.jsxs("div",{className:"h-full bg-gray-900/95 border border-gray-700 rounded-lg flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-700 flex-shrink-0",children:e.jsx("h3",{className:"text-lg font-bold text-purple-400",children:"Chain Builder"})}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",onDragOver:u,onDragLeave:j,onDrop:n,children:s.length===0?e.jsx("div",{className:`
              h-full border-2 border-dashed rounded-xl min-h-[400px]
              flex items-center justify-center transition-all
              ${m?"border-green-400 bg-green-500/10 scale-[1.02]":"border-gray-600 bg-gray-800/20"}
            `,children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(L,{className:"w-20 h-20 mx-auto mb-6"}),e.jsx("p",{className:"text-3xl mb-3",children:"ðŸŽµ Drag tracks here to build your EDM chain"}),e.jsx("p",{className:"text-lg mb-2",children:"Supports MP3, WAV, OGG formats"}),e.jsx("p",{className:"text-base mt-3",children:"Start with major tracks, then add fillers and samples"}),e.jsx("p",{className:"text-sm mt-6 text-blue-400",children:"Use the Track Library on the left to upload files"})]})}):e.jsx("div",{className:"space-y-6",children:s.map((l,r)=>e.jsx(D,{track:l,index:r,isLast:r===s.length-1,onPlay:w,onEdit:y,onRemove:C,onTransitionChange:E,onWaveformReady:c,onSpectrogramReady:h,isPlaying:v,currentTime:f},l.chainId))})})]})});U.displayName="ChainBuilder";export{U as ChainBuilder};
